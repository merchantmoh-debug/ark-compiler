// ARK OMEGA-POINT TEST SUITE v2.1
// Classification: Universal Cognitive Operating System Test
// Status: Immutable | Zero-Loss

// --- Constants ---
true := 1 == 1
false := 1 == 0

// --- Helper Functions ---
func assert(condition, message) {
    if condition {
        print("PASS: " + message)
    } else {
        print("FAIL: " + message)
        1 / 0
    }
}

// 1. Test If-Else (Basic & Nested)
func test_if_else() {
    print("--- Testing If-Else ---")

    // Basic
    if true { assert(true, "Basic if true") }
    else { assert(false, "Basic if true failed") }

    if false { assert(false, "Basic if false failed") }
    else { assert(true, "Basic else true") }

    // Nested
    x := 10
    if x > 5 {
        if x < 20 {
            assert(true, "Nested if (10 > 5 and 10 < 20)")
        } else {
            assert(false, "Nested if failed inner")
        }
    } else {
        assert(false, "Nested if failed outer")
    }

    // Else-If Logic
    val := 50
    if val < 10 {
        assert(false, "val < 10 failed")
    } else if val > 100 {
        assert(false, "val > 100 failed")
    } else {
        assert(true, "else if chain correct (10 <= val <= 100)")
    }
}

// 2. Test While Loop (Basic & Nested)
func test_loops() {
    print("--- Testing Loops ---")

    // Basic
    i := 0
    sum := 0
    while i < 5 {
        sum := sum + i
        i := i + 1
    }
    assert(sum == 10, "Sum 0..4 is 10")

    // Nested
    row := 0
    total_cells := 0
    while row < 3 {
        col := 0
        while col < 2 {
            total_cells := total_cells + 1
            col := col + 1
        }
        row := row + 1
    }
    assert(total_cells == 6, "Nested loop 3x2 cells")
}

// 3. Test Functions & Scoping
func add(a, b) { return a + b }

func local_scope_test() {
    x := 500 // Local x, should not affect caller's x
}

func test_functions() {
    print("--- Testing Functions ---")

    // Basic Call
    assert(add(10, 20) == 30, "add(10, 20) == 30")

    // Scoping check (Block Scope vs Function Scope)
    x := 100
    if true {
        x := 200 // Should update outer x because Ark (impl) shares scope for blocks
    }
    assert(x == 200, "If-block updates function-scope variable")

    // Function Scope Isolation
    local_scope_test()
    assert(x == 200, "Inner function call does not affect outer function variable")
}

// 4. Test Recursion
func fib(n) {
    if n < 2 { return n }
    return fib(n - 1) + fib(n - 2)
}

func test_recursion() {
    print("--- Testing Recursion ---")
    assert(fib(6) == 8, "fib(6) == 8")
    assert(fib(0) == 0, "fib(0) == 0")
}

// 5. Test Logical Operators (Short-circuit)
func test_logic() {
    print("--- Testing Logic ---")

    // AND
    if true and true { assert(true, "true and true") }
    if true and false { assert(false, "true and false failed") } else { assert(true, "true and false is false") }

    // OR
    if false or true { assert(true, "false or true") }
    if false or false { assert(false, "false or false failed") } else { assert(true, "false or false is false") }

    // Mixed
    if (1 < 2) and (3 > 2) { assert(true, "Complex condition pass") }
}

// 6. Test Higher Order Functions
func apply(f, val) {
    return f(val)
}

func square(n) { return n * n }

func test_higher_order() {
    print("--- Testing Higher Order Functions ---")
    res := apply(square, 4)
    assert(res == 16, "apply(square, 4) == 16")
}

// Run All Tests
test_if_else()
test_loops()
test_functions()
test_recursion()
test_logic()
test_higher_order()

print("ALL TESTS COMPLETED SUCCESSFULLY")
